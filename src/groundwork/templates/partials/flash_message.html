{#
    Flash Message Partial
    Used for displaying notifications/alerts
    Supports: info, success, warning, error types

    Expected context:
    - message.type: 'info' | 'success' | 'warning' | 'error'
    - message.text: The message content
    - message.title: Optional title for the message
    - message.id: Optional unique ID for targeting with HTMX
#}
{% set msg_id = message.id|default('flash-' ~ range(10000, 99999)|random) %}
{% set msg_type = message.type|default('info') %}

<div
    class="flash-message alert alert--{{ msg_type }}"
    id="{{ msg_id }}"
    role="alert"
    aria-live="polite"
>
    <!-- Icon based on message type -->
    {% if msg_type == 'success' %}
    <svg class="alert__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
        <polyline points="22 4 12 14.01 9 11.01"></polyline>
    </svg>
    {% elif msg_type == 'warning' %}
    <svg class="alert__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
        <line x1="12" y1="9" x2="12" y2="13"></line>
        <line x1="12" y1="17" x2="12.01" y2="17"></line>
    </svg>
    {% elif msg_type == 'error' %}
    <svg class="alert__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="15" y1="9" x2="9" y2="15"></line>
        <line x1="9" y1="9" x2="15" y2="15"></line>
    </svg>
    {% else %}
    <svg class="alert__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="16" x2="12" y2="12"></line>
        <line x1="12" y1="8" x2="12.01" y2="8"></line>
    </svg>
    {% endif %}

    <div class="alert__content">
        {% if message.title %}
        <div class="alert__title">{{ message.title }}</div>
        {% endif %}
        <div class="alert__message">{{ message.text }}</div>
    </div>

    <!-- Close button -->
    <button
        type="button"
        class="alert__close"
        aria-label="Dismiss message"
        onclick="dismissFlash('{{ msg_id }}')"
    >
        <svg class="alert__close-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
    </button>
</div>

<script>
    // Dismiss flash message with animation
    function dismissFlash(id) {
        const element = document.getElementById(id);
        if (element) {
            element.classList.add('flash-message--exiting');
            setTimeout(function() {
                element.remove();
            }, 300); // Match animation duration
        }
    }

    // Auto-dismiss flash messages after 5 seconds (except errors)
    (function() {
        const flashId = '{{ msg_id }}';
        const flashType = '{{ msg_type }}';

        // Don't auto-dismiss errors - user should acknowledge them
        if (flashType !== 'error') {
            setTimeout(function() {
                dismissFlash(flashId);
            }, 5000);
        }
    })();
</script>
