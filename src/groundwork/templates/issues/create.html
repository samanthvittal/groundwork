{% extends "layouts/app.html" %}

{% block title %}Create Issue - {{ project.key }}{% endblock %}

{% block page_header %}
<div class="page-header">
    <div class="page-header__content">
        <nav class="breadcrumbs">
            <a href="/projects" class="breadcrumbs__link">Projects</a>
            <span class="breadcrumbs__separator">/</span>
            <a href="/projects/{{ project.id }}" class="breadcrumbs__link">{{ project.key }}</a>
            <span class="breadcrumbs__separator">/</span>
            <a href="/projects/{{ project.key }}/issues" class="breadcrumbs__link">Issues</a>
            <span class="breadcrumbs__separator">/</span>
            <span class="breadcrumbs__current">Create</span>
        </nav>
        <h1 class="page-header__title">
            {% if parent_issue %}
            Create Subtask
            {% else %}
            Create Issue
            {% endif %}
        </h1>
        <p class="page-header__description">
            {% if parent_issue %}
            Add a subtask to {{ parent_issue.key }}
            {% else %}
            Add a new issue to {{ project.name }}
            {% endif %}
        </p>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="issue-create">
    <div class="card" style="max-width: 600px;">
        <div class="card__header">
            <h2 class="card__title">Issue Details</h2>
        </div>
        <div class="card__body">
            <form method="post" class="form">
                {% if parent_issue %}
                <input type="hidden" name="parent_id" value="{{ parent_issue.id }}">

                <div class="form-group">
                    <label class="form-label">Parent Issue</label>
                    <div class="form-static">
                        <a href="/issues/{{ parent_issue.key }}" class="issue-key-link">{{ parent_issue.key }}</a>
                        {{ parent_issue.title }}
                    </div>
                </div>
                {% endif %}

                <!-- Title -->
                <div class="form-group{% if errors.title %} form-group--error{% endif %}">
                    <label class="form-label form-label--required" for="title">Title</label>
                    <input
                        type="text"
                        id="title"
                        name="title"
                        class="form-input"
                        value="{{ title or '' }}"
                        placeholder="Brief summary of the issue"
                        required
                        maxlength="500"
                        autofocus
                    >
                    {% if errors.title %}
                    <span class="form-error">{{ errors.title }}</span>
                    {% endif %}
                </div>

                <!-- Type -->
                <div class="form-group{% if errors.type_id %} form-group--error{% endif %}">
                    <label class="form-label form-label--required" for="type_id">Type</label>
                    <select id="type_id" name="type_id" class="form-select" required>
                        <option value="">Select a type</option>
                        {% for t in issue_types %}
                        <option value="{{ t.id }}" {% if selected_type == t.id|string %}selected{% endif %}>
                            {{ t.name }}
                        </option>
                        {% endfor %}
                    </select>
                    {% if errors.type_id %}
                    <span class="form-error">{{ errors.type_id }}</span>
                    {% else %}
                    <span class="form-hint">Categorizes the kind of work</span>
                    {% endif %}
                </div>

                <!-- Priority -->
                <div class="form-group">
                    <label class="form-label" for="priority">Priority</label>
                    <select id="priority" name="priority" class="form-select">
                        {% for p in priorities %}
                        <option value="{{ p.value }}" {% if (selected_priority or 'medium') == p.value %}selected{% endif %}>
                            {{ p.value|capitalize }}
                        </option>
                        {% endfor %}
                    </select>
                    <span class="form-hint">How urgently this needs attention</span>
                </div>

                <!-- Status -->
                <div class="form-group">
                    <label class="form-label" for="status_id">Status</label>
                    <select id="status_id" name="status_id" class="form-select">
                        <option value="">Default (To Do)</option>
                        {% for s in statuses %}
                        <option value="{{ s.id }}" {% if selected_status == s.id|string %}selected{% endif %}>
                            {{ s.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Assignee -->
                <div class="form-group">
                    <label class="form-label" for="assignee_id">Assignee</label>
                    <select id="assignee_id" name="assignee_id" class="form-select">
                        <option value="">Unassigned</option>
                        {% for member in members %}
                        <option value="{{ member.user.id }}" {% if selected_assignee == member.user.id|string %}selected{% endif %}>
                            {{ member.user.full_name }} ({{ member.user.email }})
                        </option>
                        {% endfor %}
                    </select>
                    <span class="form-hint">Who is responsible for this issue</span>
                </div>

                <!-- Description -->
                <div class="form-group">
                    <label class="form-label" for="description">Description</label>
                    <textarea
                        id="description"
                        name="description"
                        class="form-input form-textarea"
                        rows="6"
                        placeholder="Add more details about the issue..."
                    >{{ description or '' }}</textarea>
                </div>

                <div class="form-actions form-actions--between" style="margin-top: var(--spacing-6);">
                    <a href="/projects/{{ project.key }}/issues" class="btn btn--secondary">Cancel</a>
                    <button type="submit" class="btn btn--primary">Create Issue</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
.form-static {
    padding: var(--spacing-2) var(--spacing-3);
    background: var(--color-bg-secondary);
    border-radius: var(--radius-md);
    font-size: var(--font-size-sm);
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
}

.issue-key-link {
    font-family: var(--font-mono);
    font-weight: var(--font-weight-medium);
    color: var(--color-primary);
    text-decoration: none;
}

.issue-key-link:hover {
    text-decoration: underline;
}

.form-textarea {
    resize: vertical;
    min-height: 120px;
}

.breadcrumbs {
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
    font-size: var(--font-size-sm);
    margin-bottom: var(--spacing-2);
}

.breadcrumbs__link {
    color: var(--color-text-secondary);
    text-decoration: none;
}

.breadcrumbs__link:hover {
    color: var(--color-primary);
}

.breadcrumbs__separator {
    color: var(--color-text-muted);
}

.breadcrumbs__current {
    color: var(--color-text);
}
</style>
{% endblock %}
