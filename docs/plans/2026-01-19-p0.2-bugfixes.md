# P0.2 UI Bugfixes Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Fix all issues found during manual E2E testing of P0.2 UI Templates

**Architecture:** Direct fixes to templates, views, and CSS - no new models or services needed

**Tech Stack:** FastAPI views, Jinja2 templates, CSS

**Reference:** `docs/issues/2026-01-19-p0.2-ui-issues.md`

---

## Task 1: Fix Logout Method Not Allowed

**Files:**
- Modify: `src/groundwork/views/auth.py:89`

**Step 1: Write the failing test**

```python
# tests/views/test_auth_views.py
@pytest.mark.asyncio
async def test_logout_post_clears_cookies(client: AsyncClient, auth_cookies: dict):
    """Test that POST /logout clears cookies and redirects."""
    response = await client.post("/logout", cookies=auth_cookies, follow_redirects=False)
    assert response.status_code == 303
    assert response.headers.get("location") == "/login"
```

**Step 2: Run test to verify it fails**

Run: `uv run pytest tests/views/test_auth_views.py::test_logout_post_clears_cookies -v`
Expected: FAIL with 405 Method Not Allowed

**Step 3: Fix the view**

Change line 89 in `src/groundwork/views/auth.py`:
```python
# Before
@router.get("/logout")

# After
@router.post("/logout")
```

**Step 4: Run test to verify it passes**

Run: `uv run pytest tests/views/test_auth_views.py::test_logout_post_clears_cookies -v`
Expected: PASS

**Step 5: Run full test suite**

Run: `uv run pytest tests/ -x -q`
Expected: All tests pass

**Step 6: Manual verification**

1. Start server: `uv run uvicorn groundwork.main:app --reload`
2. Login at http://localhost:8000/login
3. Click user menu dropdown
4. Click "Sign out"
5. Verify: Redirected to login page, cookies cleared

**Step 7: Commit**

```bash
git add src/groundwork/views/auth.py tests/views/test_auth_views.py
git commit -m "fix: change logout view from GET to POST to match template"
```

---

## Task 2: Fix Preferences Link (Redirect to Profile)

**Files:**
- Modify: `src/groundwork/views/profile.py`

**Step 1: Write the failing test**

```python
# tests/views/test_profile_views.py
@pytest.mark.asyncio
async def test_preferences_redirects_to_profile(client: AsyncClient, auth_cookies: dict):
    """Test that /preferences redirects to /profile."""
    response = await client.get("/preferences", cookies=auth_cookies, follow_redirects=False)
    assert response.status_code == 303
    assert response.headers.get("location") == "/profile"
```

**Step 2: Run test to verify it fails**

Run: `uv run pytest tests/views/test_profile_views.py::test_preferences_redirects_to_profile -v`
Expected: FAIL with 404 Not Found

**Step 3: Add the redirect route**

Add to `src/groundwork/views/profile.py` after the imports:
```python
@router.get("/preferences")
async def preferences_redirect() -> RedirectResponse:
    """Redirect /preferences to /profile."""
    return RedirectResponse(url="/profile", status_code=303)
```

**Step 4: Run test to verify it passes**

Run: `uv run pytest tests/views/test_profile_views.py::test_preferences_redirects_to_profile -v`
Expected: PASS

**Step 5: Run full test suite**

Run: `uv run pytest tests/ -x -q`
Expected: All tests pass

**Step 6: Manual verification**

1. Login at http://localhost:8000/login
2. Click user menu dropdown
3. Click "Preferences"
4. Verify: Redirected to /profile page

**Step 7: Commit**

```bash
git add src/groundwork/views/profile.py tests/views/test_profile_views.py
git commit -m "fix: add /preferences redirect to /profile"
```

---

## Task 3: Fix Sidebar Admin Links

**Files:**
- Modify: `src/groundwork/templates/components/sidebar.html`

**Step 1: Identify changes needed**

Update sidebar links from:
- `/admin/users` → `/users`
- `/admin/roles` → `/roles`
- `/admin/settings` → `/settings` (will need placeholder)
- Update `active_nav` checks from `admin_users` → `users`, etc.

**Step 2: Update sidebar.html**

In `src/groundwork/templates/components/sidebar.html`, update the Administration section:

```html
<!-- Before -->
<a href="/admin/users" class="sidebar__link {% if active_nav == 'admin_users' %}sidebar__link--active{% endif %}">

<!-- After -->
<a href="/users" class="sidebar__link {% if active_nav == 'users' %}sidebar__link--active{% endif %}">
```

Apply same pattern for roles and settings links.

**Step 3: Create placeholder view for unimplemented pages**

Add to `src/groundwork/views/__init__.py` or create new file `src/groundwork/views/placeholder.py`:

```python
@router.get("/dashboard")
@router.get("/projects")
@router.get("/tasks")
@router.get("/calendar")
@router.get("/team")
@router.get("/messages")
@router.get("/settings")
async def coming_soon(request: Request, current_user: CurrentUser) -> Response:
    """Placeholder for unimplemented pages."""
    return templates.TemplateResponse(
        "pages/coming_soon.html",
        {"request": request, "current_user": current_user}
    )
```

**Step 4: Create coming_soon.html template**

Create `src/groundwork/templates/pages/coming_soon.html`:
```html
{% extends "layouts/app.html" %}
{% block title %}Coming Soon{% endblock %}
{% block content %}
<div class="card">
    <div class="card__body text-center">
        <h1>Coming Soon</h1>
        <p class="text-secondary">This feature is under development.</p>
    </div>
</div>
{% endblock %}
```

**Step 5: Run full test suite**

Run: `uv run pytest tests/ -x -q`
Expected: All tests pass

**Step 6: Manual verification**

1. Login at http://localhost:8000/login
2. Click each sidebar link
3. Verify: Admin links work, other links show "Coming Soon"

**Step 7: Commit**

```bash
git add src/groundwork/templates/components/sidebar.html \
        src/groundwork/templates/pages/coming_soon.html \
        src/groundwork/views/
git commit -m "fix: update sidebar links and add coming soon placeholder"
```

---

## Task 4: Fix Dark Mode Button Text Color

**Files:**
- Modify: `src/groundwork/static/css/themes/dark.css`

**Step 1: Add the CSS override**

Add to the button adjustments section in `dark.css` (around line 156):

```css
[data-theme="dark"] .btn--primary {
    color: #ffffff;
}

[data-theme="dark"] .btn--primary:hover {
    color: #ffffff;
}

[data-theme="dark"] .btn--danger {
    color: #ffffff;
}

[data-theme="dark"] .btn--danger:hover {
    color: #ffffff;
}

[data-theme="dark"] .btn--success {
    color: #ffffff;
}

[data-theme="dark"] .btn--success:hover {
    color: #ffffff;
}
```

**Step 2: Manual verification**

1. Login at http://localhost:8000/login
2. Switch to Dark mode
3. Navigate to Users page
4. Verify: "Create User" button has white text on blue background

**Step 3: Commit**

```bash
git add src/groundwork/static/css/themes/dark.css
git commit -m "fix: ensure proper text contrast for buttons in dark mode"
```

---

## Task 5: Post-Login Redirect (Pending Discussion)

**Status:** BLOCKED - Needs stakeholder decision

**Options:**
1. Keep current behavior (redirect to `/users`)
2. Redirect to `/profile` temporarily
3. Redirect to `/dashboard` (needs Dashboard to be implemented)

**Action:** Discuss with stakeholder before implementing

---

## Execution Order

1. Task 1: Fix Logout (High priority - blocks testing)
2. Task 3: Fix Sidebar Links (High priority - navigation broken)
3. Task 2: Fix Preferences Link (Medium priority)
4. Task 4: Fix Dark Mode Buttons (Low priority - cosmetic)
5. Task 5: Post-Login Redirect (Blocked - needs discussion)

---

## Final Steps

After all tasks complete:

1. Run full test suite: `uv run pytest tests/ -x`
2. Manual E2E verification of all fixed issues
3. Update issues document with "Fixed" status
4. Create PR or merge to main

---

## Notes for Context Restoration

If context is cleared/compacted, reference:
- Issues: `docs/issues/2026-01-19-p0.2-ui-issues.md`
- This plan: `docs/plans/2026-01-19-p0.2-bugfixes.md`
- Branch: `feature/p0.2-ui-templates`
- Worktree: `/home/samanthvrao/Development/Projects/groundwork/.worktrees/p0.2-ui-templates`
