{% extends "layouts/app.html" %}

{% block title %}Roles{% endblock %}

{% block page_header %}
<div class="page-header">
    <div class="page-header__content">
        <h1 class="page-header__title">Roles</h1>
        <p class="page-header__description">Manage user roles and permissions</p>
    </div>
    <div class="page-header__actions">
        {% if can_create %}
        <a href="/roles/create" class="btn btn--primary">
            <svg class="btn__icon" viewBox="0 0 20 20" fill="currentColor" width="16" height="16">
                <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
            </svg>
            Create Role
        </a>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block content %}
<div class="roles-list">
    {% if success %}
    <div class="alert alert--success" style="margin-bottom: var(--spacing-4);">
        <div class="alert__content">
            <p class="alert__message">{{ success }}</p>
        </div>
    </div>
    {% endif %}

    {% if error %}
    <div class="alert alert--error" style="margin-bottom: var(--spacing-4);">
        <div class="alert__content">
            <p class="alert__message">{{ error }}</p>
        </div>
    </div>
    {% endif %}

    <div class="card">
        <div class="card__body card__body--no-padding">
            {% if roles %}
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Description</th>
                            <th>Permissions</th>
                            <th>Users</th>
                            <th class="table__actions-col">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for role in roles %}
                        <tr>
                            <td>
                                <div class="role-cell">
                                    <span class="role-cell__name">{{ role.name }}</span>
                                    {% if role.is_system %}
                                    <span class="badge badge--info badge--sm">System</span>
                                    {% endif %}
                                </div>
                            </td>
                            <td class="text-secondary">{{ role.description }}</td>
                            <td>
                                <span class="badge badge--secondary">{{ role.permissions|length }}</span>
                            </td>
                            <td>
                                <span class="badge badge--secondary">{{ role.users|length }}</span>
                            </td>
                            <td class="table__actions-col">
                                <div class="table-actions">
                                    <a href="/roles/{{ role.id }}" class="btn btn--ghost btn--sm" title="View">
                                        <svg viewBox="0 0 20 20" fill="currentColor" width="16" height="16">
                                            <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                                            <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                                        </svg>
                                    </a>
                                    {% if can_update %}
                                    <a href="/roles/{{ role.id }}/edit" class="btn btn--ghost btn--sm" title="Edit">
                                        <svg viewBox="0 0 20 20" fill="currentColor" width="16" height="16">
                                            <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                                        </svg>
                                    </a>
                                    {% endif %}
                                    {% if can_delete and not role.is_system %}
                                    <form method="post" action="/roles/{{ role.id }}/delete" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this role? Users with this role will need to be reassigned.');">
                                        <button type="submit" class="btn btn--ghost btn--sm btn--danger-hover" title="Delete">
                                            <svg viewBox="0 0 20 20" fill="currentColor" width="16" height="16">
                                                <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                            </svg>
                                        </button>
                                    </form>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-state__icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="48" height="48">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z" />
                    </svg>
                </div>
                <h3 class="empty-state__title">No roles found</h3>
                <p class="empty-state__description">
                    Get started by creating the first role.
                </p>
                {% if can_create %}
                <a href="/roles/create" class="btn btn--primary">Create Role</a>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
.role-cell {
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
}

.role-cell__name {
    font-weight: var(--font-weight-medium);
}

.table-actions {
    display: flex;
    gap: var(--spacing-1);
}

.btn--danger-hover:hover {
    color: var(--color-error);
}

.empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: var(--spacing-12) var(--spacing-6);
    text-align: center;
}

.empty-state__icon {
    color: var(--color-text-muted);
    margin-bottom: var(--spacing-4);
}

.empty-state__title {
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    color: var(--color-text);
    margin-bottom: var(--spacing-2);
}

.empty-state__description {
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    margin-bottom: var(--spacing-4);
    max-width: 400px;
}

.badge--sm {
    font-size: var(--font-size-xs);
    padding: 2px 6px;
}
</style>
{% endblock %}
